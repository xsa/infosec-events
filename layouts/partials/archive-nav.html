{{/* layouts/partials/archive-nav.html */}}
{{ $items := slice }}
{{ $section := site.GetPage "section" "archives" }}

{{ if $section }}
  {{/* Collect all year pages */}}
  {{ range $section.RegularPages }}
    {{ $fname := .File.BaseFileName }}
    {{ if findRE `^(19|20)[0-9]{2}$` $fname }}
      {{ $year := int $fname }}
      {{ $items = $items | append (dict "page" . "year" $year "url" .RelPermalink) }}
    {{ end }}
  {{ end }}

  {{/* Ensure current year is included */}}
  {{ $currentYear := now.Format "2006" | int }}
  {{ $found := false }}
  {{ range $items }}
    {{ if eq .year $currentYear }}
      {{ $found = true }}
    {{ end }}
  {{ end }}
  {{ if not $found }}
    {{/* Dummy entry for current year if no file exists */}}
    {{ $items = $items | append (dict "page" nil "year" $currentYear "url" (printf "/archives/%d/" $currentYear)) }}
  {{ end }}

  {{/* Sort descending so newest year is first */}}
  {{ $items = sort $items "year" "desc" }}

  <nav class="archive-years">
    <ul style="display:flex; gap:1rem; list-style:none; padding:0;">
      {{ range $items }}
        {{ $url := "/" }}
        {{ if .page }}
          {{ $url = .page.RelPermalink }}
        {{ else }}
          {{ $url = printf "/archives/%d/" .year }}
        {{ end }}
        <li>
          <a href="{{ $url }}">{{ .year }}</a>
        </li>
      {{ end }}
    </ul>
  </nav>
{{ end }}