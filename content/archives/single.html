{{/* layouts/archives/single.html */}}
{{ define "main" }}
  <main class="container">
    <article>
      <header>
        <h1>{{ .Title }}</h1>
      </header>

      <div class="post-content">
        {{ .Content }}
      </div>

      {{/* Build a sorted (desc) list of { page, year } for navigation */}}
      {{ $section := .CurrentSection }}
      {{ $items := slice }}
      {{ range $section.Pages }}
        {{ $fname := .File.BaseFileName }}
        {{ $year := atoi $fname }}
        {{ if $year }}
          {{ $items = $items | append (dict "page" . "year" $year) }}
        {{ end }}
      {{ end }}
      {{ $items = sort $items "year" "desc" }}

      {{/* Find current index */}}
      {{ $current := . }}
      {{ $idx := -1 }}
      {{ range $i, $it := $items }}
        {{ if eq $it.page.RelPermalink $current.RelPermalink }}
          {{ $idx = $i }}
        {{ end }}
      {{ end }}

      {{/* Compute neighbors */}}
      {{ $prev := nil }}
      {{ $next := nil }}
      {{ if ge $idx 0 }}
        {{ if lt (add $idx 1) (len $items) }}
          {{ $next = index $items (add $idx 1) }}
        {{ end }}
        {{ if gt $idx 0 }}
          {{ $prev = index $items (sub $idx 1) }}
        {{ end }}
      {{ end }}

      <hr>

      <nav class="archive-nav" aria-label="Year navigation">
        <ul style="display:flex;justify-content:space-between;list-style:none;padding:0">
          <li>
            {{ if $prev }}
              {{ $p := index $prev "page" }}
              {{ $y := index $prev "year" }}
              ← <a href="{{ $p.RelPermalink }}">Previous: {{ $y }}</a>
            {{ end }}
          </li>
          <li>
            <a href="{{ .CurrentSection.RelPermalink }}">Back to Archive</a>
          </li>
          <li>
            {{ if $next }}
              {{ $n := index $next "page" }}
              {{ $y2 := index $next "year" }}
              <a href="{{ $n.RelPermalink }}">Next: {{ $y2 }}</a> →
            {{ end }}
          </li>
        </ul>
      </nav>
    </article>
  </main>
{{ end }}
``
